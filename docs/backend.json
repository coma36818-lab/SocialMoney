{
  "entities": {
    "Post": {
      "name": "Post",
      "type": "object",
      "properties": {
        "mediaUrl": {
          "type": "string",
          "description": "URL del media caricato"
        },
        "mediaType": {
          "type": "string",
          "enum": [
            "video",
            "photo",
            "audio"
          ],
          "description": "Tipo di media"
        },
        "authorName": {
          "type": "string",
          "description": "Nome dell'autore (opzionale)"
        },
        "authorId": {
          "type": "string",
          "description": "ID univoco dell'autore"
        },
        "description": {
          "type": "string",
          "description": "Descrizione del post"
        },
        "likes": {
          "type": "number",
          "default": 0,
          "description": "Numero di like ricevuti"
        },
        "boostScore": {
          "type": "number",
          "default": 0,
          "description": "Punteggio boost per classifica"
        },
        "creditValue": {
          "type": "number",
          "default": 0,
          "description": "Valore dei like in â‚¬ per l'autore"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp del post"
        },
        "boostPurchased": {
          "type": "number",
          "default": 0,
          "description": "Numero di boost acquistati"
        },
        "likesWeek": {
          "type": "number",
          "default": 0
        }
      },
      "required": [
        "mediaUrl",
        "mediaType",
        "authorId"
      ]
    },
    "Comment": {
      "name": "Comment",
      "type": "object",
      "properties": {
        "post_id": {
          "type": "string",
          "description": "ID del post commentato"
        },
        "author_name": {
          "type": "string",
          "description": "Nome dell'autore del commento"
        },
        "text": {
          "type": "string",
          "description": "Testo del commento"
        }
      },
      "required": [
        "post_id",
        "text"
      ]
    },
    "LikePackage": {
      "name": "LikePackage",
      "type": "object",
      "properties": {
        "packageName": {
          "type": "string",
          "description": "Name of the like package"
        },
        "likeCount": {
          "type": "number",
          "description": "Number of likes in the package"
        },
        "priceEuro": {
          "type": "number",
          "description": "Price of the package in Euro"
        }
      },
      "required": [
        "packageName",
        "likeCount",
        "priceEuro"
      ]
    },
    "Transaction": {
      "name": "Transaction",
      "type": "object",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique localStorage ID for the user"
        },
        "postId": {
          "type": "string",
          "description": "ID of the purchased post (optional)"
        },
        "likeCount": {
          "type": "number",
          "description": "Number of likes purchased"
        },
        "pricePaid": {
          "type": "number",
          "description": "Price paid in Euro"
        },
        "paypalTxId": {
          "type": "string",
          "description": "PayPal transaction ID"
        },
        "type": {
          "type": "string",
          "enum": [
            "likePurchase",
            "withdraw"
          ],
          "description": "Type of transaction"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the transaction"
        }
      },
      "required": [
        "userId",
        "pricePaid",
        "paypalTxId",
        "type",
        "timestamp"
      ]
    },
    "Wallet": {
      "name": "Wallet",
      "type": "object",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique localStorage ID for the user/author"
        },
        "credit": {
          "type": "number",
          "description": "Accumulated credit from likes in Euro"
        },
        "commission": {
          "type": "number",
          "description": "Commission rate on each purchased like"
        },
        "lastUpdate": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the last wallet update"
        }
      },
      "required": [
        "userId",
        "credit",
        "lastUpdate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores social media posts with media, author, and engagement data.",
          "params": [
            {
              "name": "postId",
              "description": "Unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments for posts."
        }
      },
      {
        "path": "likePackages/{packageId}",
        "definition": {
          "entityName": "LikePackage",
          "schema": {
            "$ref": "#/backend/entities/LikePackage"
          },
          "description": "Stores purchasable like packages."
        }
      },
      {
        "path": "transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores all PayPal transactions for likes and withdrawals."
        }
      },
      {
        "path": "wallets/{walletId}",
        "definition": {
          "entityName": "Wallet",
          "schema": {
            "$ref": "#/backend/entities/Wallet"
          },
          "description": "Stores the credit wallet for each author, identified by their unique localStorage userId.",
          "params": [
            {
              "name": "walletId",
              "description": "Should correspond to the author's userId."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the core features of the MyDatingame platform, focusing on posts, user engagement (likes), and content submission. The primary collection is `posts`, storing all social media posts.  The structure enforces authorization independence by not requiring `get()` calls in security rules, enabling atomic operations, and enhancing debuggability.  Structural segregation ensures that all documents within a collection share the same security requirements. \n\nAuthorization Independence (Denormalization): The structure avoids hierarchical authorization dependencies. Since all users can view posts and 'like' them, no denormalization of user data into the Post is required. If more complex access control was required (e.g. posts visible only to certain user groups), the group membership information would be denormalized directly into the `Post` documents.\n\nQAPs (Rules are not Filters): The structure supports secure `list` operations.  Posts are stored in a single collection, allowing for listing of posts without complex filtering logic.  Because authorization is not based on user roles and anyone can 'like' a post, security rules are simplified without needing to filter based on user-specific attributes.  Future implementations of user-specific data (e.g. drafts) would be segregated into user-specific subcollections to avoid filtering."
  }
}
