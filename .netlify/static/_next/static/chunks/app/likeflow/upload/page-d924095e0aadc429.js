(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[696],{2178:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>I});var l=t(5155),s=t(2115),i=t(6715),r=t(1966),o=t(858),n=t(5317),c=t(518),d=t(3768),u=t(6273),m=t(7933),x=t(4601),h=t(6923),f=t(1133),b=t(5318),p=t(1721),v=t(172),g=t(1978),j=t(760),y=t(5695),w=t(2523),N=t(9434);let F=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("textarea",{className:(0,N.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...s})});F.displayName="Textarea";var P=t(5839);let{firestore:k,storage:D}=(0,r.AU)(),C=()=>{let e=localStorage.getItem("likeflow_userId");return e||(e="user_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9)),localStorage.setItem("likeflow_userId",e)),e},A=()=>(0,l.jsxs)(g.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 backdrop-blur-xl z-50 flex flex-col items-center justify-center",children:[(0,l.jsxs)(g.P.div,{initial:{scale:0},animate:{scale:[0,1.2,1]},transition:{duration:.5,ease:"easeOut"},className:"relative",children:[(0,l.jsx)(g.P.div,{className:"w-24 h-24 rounded-full bg-gradient-to-br from-[#FFD700] to-[#B8860B] flex items-center justify-center",animate:{boxShadow:["0 0 0 0 rgba(255,215,0,0.4)","0 0 0 40px rgba(255,215,0,0)"]},transition:{duration:1,repeat:3},children:(0,l.jsx)(c.A,{className:"w-12 h-12 text-black"})}),[...Array(12)].map((e,a)=>(0,l.jsx)(g.P.div,{className:"absolute w-3 h-3 rounded-full",style:{background:["#FFD700","#FF6B6B","#4ECDC4","#A855F7"][a%4],top:"50%",left:"50%"},initial:{x:0,y:0,scale:0},animate:{x:100*Math.cos(30*a*Math.PI/180),y:100*Math.sin(30*a*Math.PI/180),scale:[0,1,0],opacity:[1,1,0]},transition:{duration:.8,delay:.2}},a))]}),(0,l.jsx)(g.P.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-white text-xl font-bold mt-6",children:"Pubblicato! \uD83C\uDF89"}),(0,l.jsx)(g.P.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"text-gray-400 mt-2",children:"Il tuo contenuto \xe8 online"})]});async function S(e,a,t){let l=C(),s=(0,o.KR)(D,"uploads/".concat(Date.now(),"-").concat(e.name));await (0,o.D)(s,e);let i=await (0,o.qk)(s),r={mediaUrl:i,mediaType:e.type.startsWith("video")?"video":e.type.startsWith("image")?"photo":"audio",authorName:a||"Anonimo",authorId:l,description:t||"",likes:0,likesWeek:0,boostScore:0,creditValue:0,timestamp:(0,n.O5)(),boostPurchased:0};return await (0,n.gS)((0,n.rJ)(k,"Posts"),r),i}function I(){let e=(0,y.useRouter)(),a=(0,i.jE)(),t=(0,s.useRef)(null),r=(0,s.useRef)(null),{wallet:o,useUpload:c}=(0,P.v)(),[N,D]=(0,s.useState)({authorName:"",authorPhoto:null,authorPhotoPreview:null,description:"",mediaFile:null,mediaPreview:null,mediaType:null}),[I,B]=(0,s.useState)(!1),[T,z]=(0,s.useState)(0),[R,_]=(0,s.useState)(null),[O,E]=(0,s.useState)(!1),H=async()=>{if(!N.mediaFile)return void _("Seleziona un file da caricare");B(!0),_(null),z(0);let t=setInterval(()=>{z(e=>Math.min(e+10,90))},200);try{let l=C(),s=(0,n.H9)(k,"uploadCooldowns",l);await (0,n.BN)(s,{userId:l,timestamp:(0,n.O5)()}),await S(N.mediaFile,N.authorName,N.description),z(100),clearInterval(t),a.invalidateQueries({queryKey:["posts"]}),E(!0),setTimeout(()=>{e.push("/likeflow/feed")},2500)}catch(e){clearInterval(t),"permission-denied"===e.code?_("Limite di upload giornaliero raggiunto. Riprova tra 24 ore."):(_("Errore durante il caricamento. Riprova."),console.error(e)),z(0)}finally{B(!1)}};return(0,l.jsxs)("div",{className:"min-h-screen bg-black pb-36 pt-8 md:pt-12 overflow-y-auto",children:[(0,l.jsx)(j.N,{children:O&&(0,l.jsx)(A,{})}),(0,l.jsxs)(g.P.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"sticky top-0 bg-gradient-to-b from-black to-transparent backdrop-blur-sm px-4 py-4 z-10",children:[(0,l.jsxs)("h1",{className:"text-white text-xl font-bold text-center flex items-center justify-center gap-2",children:[(0,l.jsx)(x.A,{className:"w-5 h-5 text-[#FFD700]"}),"Crea"]}),(0,l.jsx)("div",{className:"flex items-center justify-center gap-2 mt-2",children:(0,l.jsxs)(g.P.div,{className:"flex items-center gap-2 bg-[#FFD700]/10 rounded-full px-3 py-1",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0},children:[(0,l.jsx)(h.A,{className:"w-4 h-4 text-[#FFD700]"}),(0,l.jsx)("span",{className:"text-[#FFD700] text-sm font-medium",children:"1 Upload Gratuito al Giorno"})]})})]}),(0,l.jsxs)("div",{className:"px-4 py-8 md:py-12 max-w-lg mx-auto",children:[(0,l.jsx)(j.N,{children:R&&(0,l.jsxs)(g.P.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95},className:"bg-red-500/10 border border-red-500/50 rounded-2xl p-4 mb-6 flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0",children:(0,l.jsx)(f.A,{className:"w-5 h-5 text-red-500"})}),(0,l.jsx)("span",{className:"text-red-400 text-sm",children:R})]})}),(0,l.jsxs)(g.P.div,{className:"mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[N.mediaPreview?(0,l.jsxs)(g.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative rounded-3xl overflow-hidden bg-[#111] aspect-[9/16] max-h-[400px]",children:["video"===N.mediaType&&(0,l.jsx)("video",{src:N.mediaPreview,className:"w-full h-full object-cover",controls:!0}),"photo"===N.mediaType&&(0,l.jsx)("img",{src:N.mediaPreview,alt:"Preview",className:"w-full h-full object-cover"}),"audio"===N.mediaType&&(0,l.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-[#1a1a1a] to-[#0a0a0a]",children:[(0,l.jsxs)(g.P.div,{animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"relative w-32 h-32",children:[(0,l.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-[#FFD700] via-[#B8860B] to-[#8B6914] shadow-2xl shadow-[#FFD700]/30"}),(0,l.jsx)("div",{className:"absolute inset-6 rounded-full bg-black"}),(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsx)(u.A,{className:"w-16 h-16 text-[#FFD700]"})}),(0,l.jsx)("div",{className:"absolute inset-10 rounded-full border border-[#333]"}),(0,l.jsx)("div",{className:"absolute inset-16 rounded-full border border-[#333]"}),(0,l.jsx)("div",{className:"absolute inset-20 rounded-full border border-[#333]"})]}),(0,l.jsx)("audio",{src:N.mediaPreview,controls:!0,className:"w-3/4 mt-6"})]}),(0,l.jsx)(g.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>{D(e=>({...e,mediaFile:null,mediaPreview:null,mediaType:null}))},className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-black/70 backdrop-blur-sm flex items-center justify-center border border-white/20",children:(0,l.jsx)(b.A,{className:"w-5 h-5 text-white"})}),(0,l.jsxs)("div",{className:"absolute bottom-4 left-4 flex items-center gap-2 bg-black/70 backdrop-blur-sm rounded-full px-4 py-2",children:[(()=>{switch(N.mediaType){case"video":return(0,l.jsx)(d.A,{className:"w-6 h-6"});case"audio":return(0,l.jsx)(u.A,{className:"w-6 h-6"});default:return(0,l.jsx)(m.A,{className:"w-6 h-6"})}})(),(0,l.jsx)("span",{className:"text-white text-sm font-medium capitalize",children:N.mediaType})]})]}):(0,l.jsxs)(g.P.button,{whileHover:{scale:1.02,borderColor:"#FFD700"},whileTap:{scale:.98},onClick:()=>{var e;return null==(e=t.current)?void 0:e.click()},className:"w-full aspect-[9/16] max-h-[400px] rounded-3xl border-2 border-dashed border-[#333] bg-gradient-to-br from-[#111] to-[#0a0a0a] flex flex-col items-center justify-center gap-6 transition-all overflow-hidden relative",children:[(0,l.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,l.jsx)(g.P.div,{className:"absolute w-96 h-96 rounded-full bg-[#FFD700]/5 blur-3xl",animate:{x:[0,100,0],y:[0,-50,0]},transition:{duration:10,repeat:1/0,ease:"linear"}})}),(0,l.jsx)(g.P.div,{animate:{y:[0,-10,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"relative z-10",children:(0,l.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-[#FFD700] to-[#B8860B] flex items-center justify-center shadow-lg shadow-[#FFD700]/20",children:(0,l.jsx)(h.A,{className:"w-10 h-10 text-black"})})}),(0,l.jsxs)("div",{className:"text-center relative z-10",children:[(0,l.jsx)("p",{className:"text-white font-bold text-lg",children:"Tocca per caricare"}),(0,l.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"Video, foto o audio"}),(0,l.jsx)("p",{className:"text-gray-600 text-xs mt-1",children:"Max 20MB"})]}),(0,l.jsxs)("div",{className:"flex gap-4 mt-2 relative z-10",children:[(0,l.jsxs)(g.P.div,{whileHover:{scale:1.1},className:"flex flex-col items-center gap-1",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-[#222] flex items-center justify-center",children:(0,l.jsx)(m.A,{className:"w-6 h-6 text-[#FFD700]"})}),(0,l.jsx)("span",{className:"text-gray-500 text-xs",children:"Foto"})]}),(0,l.jsxs)(g.P.div,{whileHover:{scale:1.1},className:"flex flex-col items-center gap-1",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-[#222] flex items-center justify-center",children:(0,l.jsx)(d.A,{className:"w-6 h-6 text-[#FFD700]"})}),(0,l.jsx)("span",{className:"text-gray-500 text-xs",children:"Video"})]}),(0,l.jsxs)(g.P.div,{whileHover:{scale:1.1},className:"flex flex-col items-center gap-1",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-[#222] flex items-center justify-center",children:(0,l.jsx)(u.A,{className:"w-6 h-6 text-[#FFD700]"})}),(0,l.jsx)("span",{className:"text-gray-500 text-xs",children:"Audio"})]})]})]}),(0,l.jsx)("input",{ref:t,type:"file",accept:"image/*,video/*,audio/*",onChange:e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];if(!t)return;let l=t.type.split("/")[0],s="photo";"video"===l?s="video":"audio"===l&&(s="audio");let i=URL.createObjectURL(t);D(e=>({...e,mediaFile:t,mediaPreview:i,mediaType:s}))},className:"hidden"})]}),(0,l.jsxs)(g.P.div,{className:"mb-6 p-4 rounded-2xl bg-[#111] border border-[#222]",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[(0,l.jsx)("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-4",children:"Informazioni autore (opzionale)"}),(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[N.authorPhotoPreview?(0,l.jsxs)(g.P.div,{initial:{scale:0},animate:{scale:1},className:"relative",children:[(0,l.jsx)("img",{src:N.authorPhotoPreview,alt:"Author",className:"w-16 h-16 rounded-full object-cover border-2 border-[#FFD700]"}),(0,l.jsx)("button",{onClick:()=>{D(e=>({...e,authorPhoto:null,authorPhotoPreview:null}))},className:"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-red-500 flex items-center justify-center",children:(0,l.jsx)(b.A,{className:"w-4 h-4 text-white"})})]}):(0,l.jsx)(g.P.button,{whileHover:{scale:1.05,borderColor:"#FFD700"},whileTap:{scale:.95},onClick:()=>{var e;return null==(e=r.current)?void 0:e.click()},className:"w-16 h-16 rounded-full border-2 border-dashed border-[#333] bg-[#0a0a0a] flex items-center justify-center transition-colors",children:(0,l.jsx)(p.A,{className:"w-7 h-7 text-gray-500"})}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(w.p,{value:N.authorName,onChange:e=>D(a=>({...a,authorName:e.target.value})),placeholder:"@username",className:"bg-[#0a0a0a] border-[#222] text-white placeholder:text-gray-600 focus:border-[#FFD700] rounded-xl"})})]}),(0,l.jsx)("input",{ref:r,type:"file",accept:"image/*",onChange:e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];if(!t)return;let l=URL.createObjectURL(t);D(e=>({...e,authorPhoto:t,authorPhotoPreview:l}))},className:"hidden"})]}),(0,l.jsx)(g.P.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,l.jsx)(F,{value:N.description,onChange:e=>D(a=>({...a,description:e.target.value})),placeholder:"Scrivi una descrizione accattivante...",rows:3,className:"bg-[#111] border-[#222] text-white placeholder:text-gray-600 focus:border-[#FFD700] resize-none rounded-2xl"})}),(0,l.jsx)(j.N,{children:I&&(0,l.jsxs)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"Caricamento..."}),(0,l.jsxs)("span",{className:"text-[#FFD700] text-sm font-bold",children:[T,"%"]})]}),(0,l.jsx)("div",{className:"h-2 bg-[#222] rounded-full overflow-hidden",children:(0,l.jsx)(g.P.div,{className:"h-full bg-gradient-to-r from-[#FFD700] to-[#B8860B]",initial:{width:0},animate:{width:"".concat(T,"%")}})})]})}),(0,l.jsx)(g.P.button,{whileHover:{scale:N.mediaFile&&!I?1.02:1},whileTap:{scale:N.mediaFile&&!I?.98:1},onClick:H,disabled:I||!N.mediaFile,className:"w-full py-4 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 transition-all ".concat(N.mediaFile&&!I?"bg-gradient-to-r from-[#FFD700] to-[#B8860B] text-black shadow-lg shadow-[#FFD700]/20":"bg-[#222] text-gray-500 cursor-not-allowed"),children:I?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(v.A,{className:"w-6 h-6 animate-spin"}),"Pubblicazione..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.A,{className:"w-6 h-6"}),"Pubblica"]})})]})]})}},2449:(e,a,t)=>{Promise.resolve().then(t.bind(t,2178))},2523:(e,a,t)=>{"use strict";t.d(a,{p:()=>r});var l=t(5155),s=t(2115),i=t(9434);let r=s.forwardRef((e,a)=>{let{className:t,type:s,...r}=e;return(0,l.jsx)("input",{type:s,className:(0,i.cn)("flex h-auto w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r})});r.displayName="Input"},5839:(e,a,t)=>{"use strict";t.d(a,{r:()=>r,v:()=>o});var l=t(5155),s=t(2115);let i=(0,s.createContext)(void 0);function r(e){let{children:a}=e,[t,r]=(0,s.useState)({likes:0,uploads:0,credits:0,commission:0}),[o,n]=(0,s.useState)(!1);(0,s.useEffect)(()=>{try{let s=localStorage.getItem("likeflow_wallet");if(s){var e,a,t,l;let i=JSON.parse(s);r({likes:null!=(e=i.likes)?e:0,uploads:null!=(a=i.uploads)?a:0,credits:null!=(t=i.credits)?t:0,commission:null!=(l=i.commission)?l:0})}else r(e=>({...e,uploads:0}))}catch(e){console.error("Failed to load wallet from localStorage",e),r(e=>({...e,uploads:0}))}n(!0)},[]),(0,s.useEffect)(()=>{o&&localStorage.setItem("likeflow_wallet",JSON.stringify(t))},[t,o]);let c=(0,s.useCallback)(e=>{r(a=>({...a,likes:a.likes+e}))},[]),d=(0,s.useCallback)(()=>!0,[]),u=(0,s.useCallback)(e=>{r(a=>({...a,uploads:a.uploads+e}))},[]),m=(0,s.useCallback)(()=>!0,[]),x=(0,s.useCallback)(e=>{r(a=>({...a,credits:a.credits+e}))},[]),h=(0,s.useCallback)(()=>{r(e=>({...e,credits:0}))},[]);return(0,l.jsx)(i.Provider,{value:{wallet:t,addLikes:c,useLike:d,addUploads:u,useUpload:m,addCredits:x,resetCredits:h},children:a})}function o(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useWallet must be used within a WalletProvider");return e}},9434:(e,a,t)=>{"use strict";t.d(a,{cn:()=>i});var l=t(2596),s=t(9688);function i(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,s.QP)((0,l.$)(a))}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,644,453,978,602,846,425,966,441,684,358],()=>a(2449)),_N_E=e.O()}]);